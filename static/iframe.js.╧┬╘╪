/*!
 * thumbplayer-h5
 * Update Date: 2023-06-02 16:26:52
 * Author: thumbplayer-h5 team
 * ---
 * Copyright (c) 2023 Tencent
 */
!function(e,t){for(var r in t)e[r]=t[r]}(window,function(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(i,a,function(t){return e[t]}.bind(null,a));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}({5:function(e,t,r){"use strict";var i;r.r(t);var a=window.SuperPlayer,n=a.VIDEO_STATE,o=a.END_STATE,l=((i={})[n.IDLE]=-1,i[n.LOAD_START]=-1,i[n.CANPLAY]=-1,i[n.END]=0,i[n.PLAYING]=1,i[n.SEEKING]=1,i[n.SEEKED]=1,i[n.PAUSE]=2,i[n.BUFFERING]=3,i),s={adStart:{type:"AD_PLAYING",vaildCall:function(e){return"preAd"===e.data.adType},resultCall:function(e){}},adEnd:{type:"AD_END",vaildCall:function(e){return"preAd"===e.data.adType},resultCall:function(e){}},timeupdate:{type:"VIDEO_TIMEUPDATE",vaildCall:function(e){return!0},resultCall:function(e){return{currentTime:e.data.playtime}}},playStateChange:{type:"stateChange",vaildCall:function(e){return!0},resultCall:function(e){return{state:l[e.data.new]||-1}}},error:{type:"PLAY_SESSION_END",vaildCall:function(e){return e.data.endState===o.ERROR},resultCall:function(e){return{code:e.data.code,message:e.data.message}}}},u={type:"vod",vid:"",cid:"",livepid:"",width:0,height:0,volume:100,autoplay:!1,mini:!1,bullet:!1,showBulletInput:!1,starttime:0,ptag:"",allowFullScreen:!0,disableplugin:"",show1080p:0,poster:"",isDebugIframe:!0,playerSpecifyId:"",origin:"",platform:"",sdtfrom:""},p=window.SuperPlayer.H5_PLAY_EVENT;var d=function(){return(d=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=window.SuperPlayer.urlTool;new(function(){function e(){var e=this;this.messageListener=function(t){var r;if(e.iframeParams.origin&&-1!==t.origin.indexOf(e.iframeParams.origin)&&!((null===(r=t.data)||void 0===r?void 0:r.type)&&-1!==t.data.type.indexOf("webpack")||t.data.indexOf&&-1!==t.data.indexOf("webpack"))){var i=t.data||{},a=i.type;"send"===a?e.execApiFromMessage(t,i):"listen"===a&&e.addListenerFromMessage(t,i)}},this.getIframeParams(),this.createSuperPlayer(this.iframeParams),this.initMessageListener(this.iframeParams)}return e.prototype.destroy=function(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.player=null},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.getIframeParams=function(){var e=c.getUrlParams();this.iframeParams=d(d({},u),this.readIframeParamsFromUrlSearchParam(e)),void 0===e.volume&&(this.iframeParams.volume=void 0),this.log("iframeParams: ",this.iframeParams)},e.prototype.readIframeParamsFromUrlSearchParam=function(e){var t={};return Object.keys(e).forEach((function(r){if(r in u){var i=r,a=typeof u[i];t[i]=function(e,t,r,i){return void 0===i&&(i="string"),void 0===e[t]?r:"number"===i?+e[t]:"boolean"===i?"true"===e[t]:e[t]}(e,i,void 0,a)}})),t},e.prototype.convertIframeParams2SuperPlayerConfig=function(e,t){t.type=["live","vod"].includes(e.type)?e.type:"vod";return["platform","sdtfrom","cid"].forEach((function(r){e[r]&&(t.businessConfig[r]=e[r])})),e.poster&&(t.poster={src:e.poster}),void 0!==e.vid&&("live"===e.type?t.videoInitConfig={cnlid:e.vid,livepid:e.livepid}:t.videoInitConfig={vid:e.vid}),t},e.prototype.getPlayParamFromIframeParams=function(e){var t=e.vid,r=e.livepid,i="live"===e.type;return[i?{cnlid:t,livepid:r}:{vid:t},{startTime:void 0!==e.starttime?e.starttime:void 0,videoReqInfoParam:i?{}:{defnpayver:e.show1080p?1:0}}]},e.prototype.createSuperPlayer=function(e){var t,r=this.convertIframeParams2SuperPlayerConfig(e,{container:"#video_container",ctrlConfig:{disableFakeFullscreen:!0},businessConfig:{}});this.log("superPlayerConfig: ",r),this.player=new window.SuperPlayer(r),void 0!==e.volume&&(this.player.volume=e.volume/100),this.player.ctrlbarPlugin.removeComponent("PictureInPicture");var i=this.getPlayParamFromIframeParams(e);e.autoplay&&(t=this.player).play.apply(t,i)},e.prototype.initMessageListener=function(e){e.origin&&(this.iframeId=e.playerSpecifyId||this.player.config.instanceId,this.log("iframeId: ",this.iframeId),parent.postMessage({type:"ready",playerSpecifyId:this.iframeId},e.origin),window.addEventListener("message",this.messageListener))},e.prototype.getOldApi2SuperPlayerApi=function(e){var t=this;return this.oldApi2SuperPlayerApi||(this.oldApi2SuperPlayerApi={play:"play",resize:void 0,pause:"pause",getVolume:function(){return 100*t.player.volume},setVolume:function(e){return t.player.volume=e/100},getPlaybackRate:function(){return t.player.playbackRate},setPlaybackRate:function(e){return t.player.playbackRate=e},getCurrentTime:function(){return t.player.playtime},getPlayerState:function(){return l[t.player.state]||-1},getDefinition:void 0,seekTo:"seek",getCid:function(){return t.player.getCommonKv("cid")},getVid:function(){return t.player.vid},getDuration:function(){return t.player.duration},getPlayerSize:void 0,getVideoSize:function(){return t.player.videoSize},enterWindowFullscreen:void 0,exitWindowFullscreen:void 0,setPoster:function(e){return t.player.posterPlugin.show(e)},getPoster:void 0,stopVideo:function(){return t.player.stop()},mute:function(){return t.player.muted=!0},unmute:function(){return t.player.muted=!1}}),this.oldApi2SuperPlayerApi[e]},e.prototype.execApiFromMessage=function(e,t){var r,i=t.action,a=t.seq,n=t.type,o=t.value,l=void 0===o?[]:o;this.log("iframe api ".concat(i," config:"),t);var s,u,p=void 0,d=this.getOldApi2SuperPlayerApi(i);"function"==typeof d?p=d.apply(void 0,l):"string"==typeof d&&"function"==typeof this.player[d]&&(p=(r=this.player)[d].apply(r,l)),(u=["number","boolean","string","undefined"]).includes(typeof(s=p))||Object.keys(s).every((function(e){return u.includes(typeof s[e])}))||(p=void 0),this.log("iframe postMessage send back:",a,p),e.source.postMessage({type:n,seq:a,action:i,value:p},e.origin)},e.prototype.addListenerFromMessage=function(e,t){var r,i=t.action,a=t.type;this.log("iframe api ".concat(i," config:"),t),r=i,-1!==Object.keys(p).findIndex((function(e){return r===p[e]}))?this.addSuperEvtMsg(e,i,a):this.addOldEvtMsg(e,i,a)},e.prototype.addOldEvtMsg=function(e,t,r){var i=this,a=s[t];a&&this.player.on(a.type,(function(n){if(a.vaildCall(n)){var o=a.resultCall(n);i.log("iframe postMessage listen back:",t,o);try{window.parent.postMessage({type:r,action:t,playerSpecifyId:i.iframeId,args:[o]},e.origin)}catch(e){i.log("listen [".concat(t,"] back error"),e)}}}))},e.prototype.addSuperEvtMsg=function(e,t,r){var i=this;this.player.on(t,(function(a){try{window.parent.postMessage({type:r,action:t,playerSpecifyId:i.iframeId},e.origin)}catch(e){i.log("listen [".concat(t,"] back error"),e)}}))},e}())}}));